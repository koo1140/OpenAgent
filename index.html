<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OpenAgent</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
:root{
  --bg:#1b1c19;
  --panel:#23241f;
  --soft:#2c2d27;
  --text:#e9e9e3;
  --muted:#a6a69d;
  --accent:#c7b85a;
  --danger:#c45c5c;
  --radius:18px;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:linear-gradient(180deg,#1b1c19,#20211c);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
}

.page{
  flex:1;
  display:none;
  flex-direction:column;
  max-width:1000px;
  margin:auto;
  width:100%;
}

.page.active{display:flex}

header{
  padding:18px;
  font-weight:600;
  color:var(--accent);
  letter-spacing:.6px;
}

.chat{
  flex:1;
  overflow-y:auto;
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.message{
  padding:12px 16px;
  border-radius:var(--radius);
  max-width:85%;
  font-size:14px;
  line-height:1.6;
  animation:fade .2s ease;
}

@keyframes fade{
  from{opacity:0;transform:translateY(4px)}
  to{opacity:1;transform:translateY(0)}
}

.user{
  align-self:flex-end;
  background:var(--soft);
}

.assistant{
  align-self:flex-start;
  background:var(--panel);
}

.message pre{
  background:#151612;
  padding:10px;
  border-radius:12px;
  overflow:auto;
}

.input-area{
  padding:14px;
  background:var(--panel);
  display:flex;
  gap:10px;
}

textarea{
  flex:1;
  resize:none;
  min-height:48px;
  max-height:180px;
  border:none;
  outline:none;
  padding:12px;
  border-radius:var(--radius);
  background:var(--soft);
  color:var(--text);
  font-size:14px;
}

button{
  border:none;
  background:var(--accent);
  color:#1b1c19;
  padding:10px 18px;
  border-radius:var(--radius);
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
button:hover{opacity:.85}

.nav{
  height:60px;
  background:var(--panel);
  display:flex;
}
.nav button{
  flex:1;
  background:none;
  color:var(--muted);
}
.nav button.active{
  color:var(--accent);
}

/* Thinking animation */

.thinking{
  display:flex;
  gap:6px;
  padding:10px 14px;
  background:var(--panel);
  border-radius:var(--radius);
  width:fit-content;
}
.dot{
  width:6px;
  height:6px;
  border-radius:50%;
  background:var(--accent);
  animation:blink 1.4s infinite both;
}
.dot:nth-child(2){animation-delay:.2s}
.dot:nth-child(3){animation-delay:.4s}
@keyframes blink{
  0%{opacity:.2}
  20%{opacity:1}
  100%{opacity:.2}
}

.error{
  background:var(--danger);
  color:white;
  padding:10px;
  text-align:center;
  font-size:13px;
}

.settings{
  padding:20px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:22px;
}

.agent-card{
  background:var(--panel);
  padding:18px;
  border-radius:24px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.agent-title{
  color:var(--accent);
  font-weight:600;
}

input,select{
  background:var(--soft);
  border:none;
  padding:10px;
  border-radius:12px;
  color:var(--text);
}

small{color:var(--muted)}

@media(min-width:800px){
  body{align-items:center}
}
</style>
</head>
<body>

<div id="chatPage" class="page active">
  <header>OpenAgent</header>
  <div id="errorBox"></div>
  <div id="chat" class="chat"></div>
  <div class="input-area">
    <textarea id="input"></textarea>
    <button onclick="handleSend()">Send</button>
  </div>
</div>

<div id="settingsPage" class="page">
  <header>Settings</header>
  <div class="settings">

    <div class="agent-card">
      <div class="agent-title">Meta Agent</div>
      <small>Fast & cheap model for analysis</small>
      <select id="meta_provider">
        <option>Groq</option>
        <option>OpenAI</option>
        <option>Mistral</option>
        <option>Anthropic</option>
        <option>Together</option>
        <option>OpenRouter</option>
        <option>DeepSeek</option>
        <option>Google</option>
      </select>
      <input id="meta_model" placeholder="Model ID (e.g., mixtral-8x7b-32768)">
      <input id="meta_key" type="password" placeholder="API Key">
    </div>

    <div class="agent-card">
      <div class="agent-title">Main Agent</div>
      <small>Smart model for user interaction & tools</small>
      <select id="main_provider">
        <option>Groq</option>
        <option>OpenAI</option>
        <option>Mistral</option>
        <option>Anthropic</option>
        <option>Together</option>
        <option>OpenRouter</option>
        <option>DeepSeek</option>
        <option>Google</option>
      </select>
      <input id="main_model" placeholder="Model ID (e.g., claude-sonnet-4-20250514)">
      <input id="main_key" type="password" placeholder="API Key">
    </div>

    <div class="agent-card">
      <div class="agent-title">Sub Agents</div>
      <small>Fast model for specialized tasks</small>
      <select id="sub_provider">
        <option>Groq</option>
        <option>OpenAI</option>
        <option>Mistral</option>
        <option>Anthropic</option>
        <option>Together</option>
        <option>OpenRouter</option>
        <option>DeepSeek</option>
        <option>Google</option>
      </select>
      <input id="sub_model" placeholder="Model ID (e.g., llama3-70b-8192)">
      <input id="sub_key" type="password" placeholder="API Key">
    </div>

    <button onclick="saveConfig()">Save Configuration</button>

  </div>
</div>

<div class="nav">
  <button id="navChat" class="active" onclick="showPage('chat')">Chat</button>
  <button id="navSettings" onclick="showPage('settings')">Settings</button>
</div>

<script>
function showPage(p){
  chatPage.classList.remove("active");
  settingsPage.classList.remove("active");
  navChat.classList.remove("active");
  navSettings.classList.remove("active");
  if(p==="chat"){
    chatPage.classList.add("active");
    navChat.classList.add("active");
  }else{
    settingsPage.classList.add("active");
    navSettings.classList.add("active");
  }
}

function addMessage(content,role){
  const div=document.createElement("div");
  div.className="message "+role;
  div.innerHTML = role==="assistant" ? marked.parse(content) : content;
  chat.appendChild(div);
  div.scrollIntoView();
}

function showThinking(){
  const t=document.createElement("div");
  t.className="thinking";
  t.id="thinking";
  t.innerHTML='<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  chat.appendChild(t);
  t.scrollIntoView();
}
function removeThinking(){
  const t=document.getElementById("thinking");
  if(t) t.remove();
}

function showError(msg){
  errorBox.innerHTML=`<div class="error">${msg}</div>`;
  setTimeout(()=>errorBox.innerHTML="",4000);
}

async function saveConfig(){
  try{
    const res=await fetch("/api/config",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        meta:{
          provider:meta_provider.value,
          model:meta_model.value,
          api_key:meta_key.value
        },
        main:{
          provider:main_provider.value,
          model:main_model.value,
          api_key:main_key.value
        },
        sub:{
          provider:sub_provider.value,
          model:sub_model.value,
          api_key:sub_key.value
        }
      })
    });
    if(!res.ok) throw new Error("Failed to save config");
    showPage("chat");
  }catch(err){
    showError(err.message);
  }
}

async function handleSend(){
  const text=input.value.trim();
  if(!text) return;
  input.value="";
  addMessage(text,"user");
  showThinking();
  try{
    const res=await fetch("/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    if(!res.ok) throw new Error("Backend error");
    const data=await res.json();
    removeThinking();
    addMessage(data.reply,"assistant");
  }catch(err){
    removeThinking();
    showError(err.message);
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    handleSend();
  }
});
</script>

</body>
</html>